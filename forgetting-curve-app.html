<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure AI-900 å­¦ç¿’è¨˜éŒ²ã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0078d4 0%, #005a9e 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeIn 0.8s ease-out;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
        }

        .tab {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative; /* ::beforeç–‘ä¼¼è¦ç´ ã®ãŸã‚ */
            overflow: hidden; /* ::beforeç–‘ä¼¼è¦ç´ ã®ãŸã‚ */
        }

        .tab::before { /* ãƒ›ãƒãƒ¼æ™‚ã®èƒŒæ™¯å¤‰åŒ–ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”¨ */
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            transition: left 0.3s ease;
            z-index: -1; /* æ–‡å­—ã‚ˆã‚Šå¾Œã‚ã« */
        }

        .tab:hover::before {
            left: 0;
        }
        
        .tab.active {
            background: white;
            color: #0078d4;
            box-shadow: 0 0 15px rgba(255,255,255,0.5); /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã‚’å…‰ã‚‰ã›ã‚‹ */
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .tab.active:hover {
            background: white; /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã®ãƒ›ãƒãƒ¼è‰²ã¯å¤‰ãˆãªã„ */
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .quiz-content {
            max-width: 800px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            animation: slideUp 0.6s ease-out;
        }

        .input-section h2, .quiz-section h2 {
            color: #0078d4;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #0078d4;
            box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(135deg, #0078d4 0%, #005a9e 100%);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(0, 120, 212, 0.2); /* å°‘ã—å½±ã‚’è¿½åŠ  */
        }

        .btn:hover {
            transform: translateY(-3px); /* å°‘ã—ä¸Šã«ç§»å‹• */
            box-shadow: 0 8px 25px rgba(0, 120, 212, 0.3); /* å½±ã‚’å¼·èª¿ */
        }

        .btn:active {
            transform: translateY(-1px); /* ã‚¯ãƒªãƒƒã‚¯æ™‚ã«å°‘ã—æ²ˆã‚€ */
            box-shadow: 0 4px 15px rgba(0, 120, 212, 0.2); /* å½±ã‚’å…ƒã«æˆ»ã™ã‹å°‘ã—å¼±ã‚ã‚‹ */
        }


        .btn-secondary {
            background: linear-gradient(135deg, #40e0d0 0%, #20b2aa 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .memory-level {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .level-display {
            font-size: 4em;
            font-weight: bold;
            color: #0078d4;
            margin: 20px 0;
            animation: pulse 2s infinite;
        }

        .level-label {
            font-size: 1.2em;
            color: #666;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 30px;
        }

        .study-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .study-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            max-height: 500px;
            overflow-y: auto;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); /* ã‚ãšã‹ãªå½±ã‚’åˆæœŸçŠ¶æ…‹ã«è¿½åŠ  */
        }

        .study-item:hover {
            background: #e9ecef;
            transform: translateX(5px) scale(1.02); /* å°‘ã—å³ã«ç§»å‹•ã—ã€ã‚ãšã‹ã«æ‹¡å¤§ */
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); /* å½±ã‚’å°‘ã—å¼·èª¿ */
        }

        .study-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .study-item-title {
            font-weight: 600;
            color: #333;
        }

        .study-item-date {
            font-size: 0.9em;
            color: #666;
        }

        .study-item-retention {
            font-size: 0.9em;
            color: #0078d4;
            margin-top: 5px;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .quiz-question {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .quiz-question h3 {
            color: #0078d4;
            margin-bottom: 20px;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            border-color: #0078d4;
            background: #f0f8ff;
        }

        .quiz-option.selected {
            border-color: #0078d4;
            background: #e6f3ff;
        }

        .quiz-option.correct {
            border-color: #28a745;
            background: #d4edda;
        }

        .quiz-option.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .quiz-feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
        }

        .quiz-feedback.correct {
            background: #d4edda;
            color: #155724;
        }

        .quiz-feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
        }

        .quiz-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-card h4 {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #0078d4;
        }

        .category-tag {
            display: inline-block;
            padding: 4px 12px;
            background: #e6f3ff;
            color: #0078d4;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .hidden {
            display: none;
        }

        @keyframes fadeInAndSlideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .study-item-appear {
            animation: fadeInAndSlideDown 0.5s ease-out forwards;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§  Azure AI-900 å­¦ç¿’è¨˜éŒ²ã‚¢ãƒ—ãƒª</h1>
            <p>Microsoft Azure AI Fundamentals è©¦é¨“å¯¾ç­– - ã‚¨ãƒ“ãƒ³ã‚°ãƒã‚¦ã‚¹ã®å¿˜å´æ›²ç·šã§åŠ¹ç‡çš„ã«å­¦ç¿’</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('study')">å­¦ç¿’è¨˜éŒ²</button>
            <button class="tab" onclick="switchTab('quiz')">å•é¡Œæ¼”ç¿’</button>
        </div>

        <div id="studySection" class="study-section">
            <div class="main-content">
                <div class="panel">
                    <div class="input-section">
                        <h2>AI-900 å­¦ç¿’å†…å®¹ã‚’è¨˜éŒ²</h2>
                        <form id="studyForm">
                            <div class="form-group">
                                <label for="category">ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
                                <select id="category" required>
                                    <option value="">ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                                    <option value="AIæ¦‚è¦">AIã®æ¦‚è¦</option>
                                    <option value="æ©Ÿæ¢°å­¦ç¿’">æ©Ÿæ¢°å­¦ç¿’ã®åŸºç¤</option>
                                    <option value="Computer Vision">Computer Vision</option>
                                    <option value="NLP">è‡ªç„¶è¨€èªå‡¦ç† (NLP)</option>
                                    <option value="ä¼šè©±å‹AI">ä¼šè©±å‹AI</option>
                                    <option value="è²¬ä»»ã‚ã‚‹AI">è²¬ä»»ã‚ã‚‹AI</option>
                                    <option value="Azure AI Services">Azure AI Services</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="topic">å­¦ç¿’ãƒˆãƒ”ãƒƒã‚¯</label>
                                <input type="text" id="topic" placeholder="ä¾‹: Azure Computer Vision ã®ç”»åƒåˆ†ææ©Ÿèƒ½" required>
                            </div>
                            <div class="form-group">
                                <label for="details">å­¦ç¿’å†…å®¹ã®è©³ç´°</label>
                                <textarea id="details" placeholder="å­¦ç¿’ã—ãŸå†…å®¹ã‚’è©³ã—ãè¨˜å…¥ã—ã¦ãã ã•ã„ã€‚&#10;ä¾‹: Computer Visionã¯ç”»åƒã‹ã‚‰ç‰©ä½“ã€äººç‰©ã€ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¤œå‡ºã€‚OCRæ©Ÿèƒ½ã§ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºãŒå¯èƒ½ã€‚" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="question">å•é¡Œ</label>
                                <textarea id="question" placeholder="è©¦é¨“å•é¡Œã‚’è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚&#10;ä¾‹: Azure Computer Visionã§å®Ÿè¡Œã§ãã‚‹ã‚¿ã‚¹ã‚¯ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="answer">ç­”ãˆ</label>
                                <textarea id="answer" placeholder="å•é¡Œã®ç­”ãˆã‚’è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚&#10;ä¾‹: ç”»åƒåˆ†æã€OCRã€é¡”æ¤œå‡ºã€ç‰©ä½“æ¤œå‡ºãªã©"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="difficulty">ç†è§£åº¦</label>
                                <select id="difficulty">
                                    <option value="1">å®Œç’§ã«ç†è§£ï¼ˆ100%ï¼‰</option>
                                    <option value="0.8">ã»ã¼ç†è§£ï¼ˆ80%ï¼‰</option>
                                    <option value="0.6">ã¾ã‚ã¾ã‚ç†è§£ï¼ˆ60%ï¼‰</option>
                                    <option value="0.4">å°‘ã—ç†è§£ï¼ˆ40%ï¼‰</option>
                                    <option value="0.2">ã»ã¨ã‚“ã©ç†è§£ã§ããšï¼ˆ20%ï¼‰</option>
                                </select>
                            </div>
                            <button type="submit" class="btn">å­¦ç¿’å†…å®¹ã‚’è¨˜éŒ²</button>
                        </form>
                    </div>
                </div>

                <div class="panel">
                    <div class="memory-level">
                        <div class="level-label">AI-900 ç·åˆè¨˜æ†¶ãƒ¬ãƒ™ãƒ«</div>
                        <div class="level-display" id="memoryLevel">0</div>
                        <div class="level-label">/ 100</div>
                    </div>

                    <div class="chart-container">
                        <canvas id="forgettingCurveChart"></canvas>
                    </div>

                    <h2 style="color: #0078d4; margin-bottom: 20px;">å­¦ç¿’å±¥æ­´</h2>
                    <div class="study-list" id="studyList">
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 11H6a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2h-3"></path>
                                <rect x="8" y="2" width="8" height="11" rx="1"></rect>
                            </svg>
                            <p>ã¾ã å­¦ç¿’è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="quizSection" class="quiz-section hidden">
            <div class="quiz-content">
                <div class="panel">
                    <h2>AI-900 å•é¡Œæ¼”ç¿’</h2>
                    
                    <div class="quiz-stats">
                        <div class="stat-card">
                            <h4>æœ¬æ—¥ã®å•é¡Œæ•°</h4>
                            <div class="value" id="todayQuestions">0</div>
                        </div>
                        <div class="stat-card">
                            <h4>æ­£ç­”ç‡</h4>
                            <div class="value" id="correctRate">0%</div>
                        </div>
                        <div class="stat-card">
                            <h4>é€£ç¶šæ­£è§£æ•°</h4>
                            <div class="value" id="streak">0</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="quizCategory">å‡ºé¡Œã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
                        <select id="quizCategory">
                            <option value="all">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼</option>
                            <option value="AIæ¦‚è¦">AIã®æ¦‚è¦</option>
                            <option value="æ©Ÿæ¢°å­¦ç¿’">æ©Ÿæ¢°å­¦ç¿’ã®åŸºç¤</option>
                            <option value="Computer Vision">Computer Vision</option>
                            <option value="NLP">è‡ªç„¶è¨€èªå‡¦ç† (NLP)</option>
                            <option value="ä¼šè©±å‹AI">ä¼šè©±å‹AI</option>
                            <option value="è²¬ä»»ã‚ã‚‹AI">è²¬ä»»ã‚ã‚‹AI</option>
                            <option value="Azure AI Services">Azure AI Services</option>
                        </select>
                    </div>

                    <button class="btn btn-secondary" onclick="generateQuiz()">å•é¡Œã‚’ç”Ÿæˆ</button>

                    <div id="quizContent" style="margin-top: 30px;">
                        </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        // å­¦ç¿’è¨˜éŒ²ã‚’ä¿å­˜ã™ã‚‹é…åˆ—
        let studyRecords = [];
        
        // ã‚¯ã‚¤ã‚ºçµ±è¨ˆ
        let quizStats = {
            today: 0,
            correct: 0,
            total: 0,
            streak: 0
        };

        // Chart.js ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        let chart = null;

        // ç¾åœ¨ã®ã‚¿ãƒ–
        let currentTab = 'study';

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã§ quizPool ã‚’å®£è¨€ (åˆæœŸå€¤ã¯ç©ºã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)
        let quizPool = {}; // â˜…ä¿®æ­£: const ã‹ã‚‰ let ã«å¤‰æ›´ã—ã€ç©ºã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§åˆæœŸåŒ–

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        window.addEventListener('DOMContentLoaded', async function() { // â˜…ä¿®æ­£: async function ã«å¤‰æ›´
            // åˆæœŸåŒ–å‡¦ç†
            console.log('ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–ã—ã¦ã„ã¾ã™...');

            // â˜…è¿½åŠ : quiz_questions.json ã‚’èª­ã¿è¾¼ã‚€å‡¦ç†
            try {
                const response = await fetch('quiz_questions.json'); // JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                quizPool = await response.json(); // èª­ã¿è¾¼ã‚“ã JSONãƒ‡ãƒ¼ã‚¿ã‚’quizPoolã«æ ¼ç´
                console.log('ã‚¯ã‚¤ã‚ºå•é¡Œã‚’æ­£å¸¸ã«èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚');
                // ã‚¯ã‚¤ã‚ºã‚«ãƒ†ã‚´ãƒªã®é¸æŠè‚¢ã‚’å‹•çš„ã«ç”Ÿæˆ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
                populateQuizCategories();
            } catch (error) {
                console.error('ã‚¯ã‚¤ã‚ºå•é¡Œã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                alert('ã‚¯ã‚¤ã‚ºå•é¡Œã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã€å½¢å¼ãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
            // â˜…ã“ã“ã¾ã§è¿½åŠ 

            updateMemoryLevel();
            updateStudyListAndAnimateNewItem(); 
            drawChart();
        });

        // â˜…è¿½åŠ : ã‚¯ã‚¤ã‚ºã‚«ãƒ†ã‚´ãƒªã®ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å‹•çš„ã«ç”Ÿæˆã™ã‚‹é–¢æ•°
        function populateQuizCategories() {
            const quizCategorySelect = document.getElementById('quizCategory');
            if (!quizCategorySelect) return;

            // æ—¢å­˜ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢ï¼ˆã€Œã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã€ã‚’é™¤ãã‹ã€ãã‚Œã‚‚å‹•çš„ã«ç”Ÿæˆï¼‰
            // ç¾åœ¨ã¯HTMLã«ã€Œã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã€ãŒãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€
            // ãã‚Œä»¥é™ã«èª­ã¿è¾¼ã‚“ã ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã—ã¾ã™ã€‚
            // ã‚‚ã—ã€Œã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã€ã‚‚å‹•çš„ã«ã—ãŸã„å ´åˆã¯ã€quizCategorySelect.innerHTML = ''; ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚
            
            // HTMLã«ã™ã§ã«ã‚ã‚‹é¸æŠè‚¢ã¯ãã®ã¾ã¾ã«ã€JSONã‹ã‚‰èª­ã¿è¾¼ã‚“ã ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ 
            const existingOptions = Array.from(quizCategorySelect.options).map(opt => opt.value);

            if (quizPool && typeof quizPool === 'object') {
                Object.keys(quizPool).forEach(categoryName => {
                    if (!existingOptions.includes(categoryName)) { // é‡è¤‡ã‚’é¿ã‘ã‚‹
                        const option = document.createElement('option');
                        option.value = categoryName;
                        option.textContent = categoryName;
                        quizCategorySelect.appendChild(option);
                    }
                });
            }
        }


        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tab) {
            currentTab = tab;
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(t => t.classList.remove('active'));
            
            if (tab === 'study') {
                document.querySelector('.tab:nth-child(1)').classList.add('active');
                document.getElementById('studySection').classList.remove('hidden');
                document.getElementById('quizSection').classList.add('hidden');
            } else {
                document.querySelector('.tab:nth-child(2)').classList.add('active');
                document.getElementById('studySection').classList.add('hidden');
                document.getElementById('quizSection').classList.remove('hidden');
                updateQuizStats();
            }
        }

        // ã‚¨ãƒ“ãƒ³ã‚°ãƒã‚¦ã‚¹ã®å¿˜å´æ›²ç·šã®è¨ˆç®—
        function calculateRetention(elapsedMinutes, initialUnderstanding) {
            const S = 1440 * initialUnderstanding; // Sã¯å¼·ã•(Strength of memory), åˆ†å˜ä½
            // ã‚¨ãƒ“ãƒ³ã‚°ãƒã‚¦ã‚¹ã®å¿˜å´æ›²ç·š R = e^(-t/S)
            // ã“ã“ã§ã¯ R ãŒ 0-1 ã®ç¯„å›²ã«ãªã‚‹ã‚ˆã†ã«èª¿æ•´ã—ã€initialUnderstanding ã‚’åˆæœŸã®è¨˜æ†¶ãƒ¬ãƒ™ãƒ«ã¨ã™ã‚‹
            // R = initialUnderstanding * e^(-t/S)
            // S (è¨˜æ†¶å¼·åº¦)ã¯åˆå›ã®å­¦ç¿’ã§ã¯ã€initialUnderstanding ã«æ¯”ä¾‹ã™ã‚‹ã¨ä»®å®š
            // ã‚ˆã‚Šæ­£ç¢ºã«ã¯ã€Sã¯å¾©ç¿’å›æ•°ãªã©ã«ã‚‚ä¾å­˜ã™ã‚‹ãŒã€ã“ã“ã§ã¯ç°¡ç•¥åŒ–
            const retention = Math.exp(-elapsedMinutes / S) * initialUnderstanding * 100;
            return Math.max(0, Math.min(100, retention)); // 0-100% ã®ç¯„å›²ã«åã‚ã‚‹
        }

        // ç·åˆè¨˜æ†¶ãƒ¬ãƒ™ãƒ«ã®è¨ˆç®—
        function calculateOverallMemoryLevel() {
            if (studyRecords.length === 0) return 0;

            let totalRetention = 0;
            const now = new Date();

            studyRecords.forEach(record => {
                const elapsedMinutes = (now - new Date(record.date)) / (1000 * 60);
                const retention = calculateRetention(elapsedMinutes, record.difficulty);
                totalRetention += retention;
            });

            return Math.round(totalRetention / studyRecords.length);
        }

        // è¨˜æ†¶ãƒ¬ãƒ™ãƒ«ã®è¡¨ç¤ºã‚’æ›´æ–°
        function updateMemoryLevel() {
            const level = calculateOverallMemoryLevel();
            const levelDisplay = document.getElementById('memoryLevel');
            levelDisplay.textContent = level;
            
            // è‰²ã®å¤‰æ›´ã¯æ—¢å­˜ã®ãƒ­ã‚¸ãƒƒã‚¯é€šã‚Š
            if (level >= 80) {
                levelDisplay.style.color = '#28a745';
            } else if (level >= 60) {
                levelDisplay.style.color = '#0078d4';
            } else if (level >= 40) {
                levelDisplay.style.color = '#ffc107';
            } else {
                levelDisplay.style.color = '#dc3545';
            }
        }

        // ã‚°ãƒ©ãƒ•ã®æç”»
        function drawChart() {
            const ctx = document.getElementById('forgettingCurveChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            const labels = [];
            const datasets = [];
            const now = new Date();

            // ã‚°ãƒ©ãƒ•ã®Xè»¸ãƒ©ãƒ™ãƒ« (ä¾‹: 0æ—¥å¾Œ, 1æ—¥å¾Œ, ..., 7æ—¥å¾Œ)
            for (let i = 0; i <= 7; i++) { // 7æ—¥é–“ã‚’ãƒ—ãƒ­ãƒƒãƒˆ
                labels.push(`${i}æ—¥å¾Œ`);
            }

            const categoryColors = {
                'AIæ¦‚è¦': '#FF6384',
                'æ©Ÿæ¢°å­¦ç¿’': '#36A2EB',
                'Computer Vision': '#FFCE56',
                'NLP': '#4BC0C0',
                'ä¼šè©±å‹AI': '#9966FF',
                'è²¬ä»»ã‚ã‚‹AI': '#FF9F40',
                'Azure AI Services': '#FFCD56' // è‰²ã‚’å°‘ã—å¤‰æ›´
            };

            studyRecords.forEach((record, index) => {
                const data = [];
                const recordDate = new Date(record.date);
                
                for (let i = 0; i <= 7; i++) { // 7æ—¥é–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¨ˆç®—
                    // iæ—¥å¾Œã®çµŒéæ™‚é–“(åˆ†)ã‚’è¨ˆç®—
                    // record.date ã‹ã‚‰ i æ—¥å¾Œã®æ™‚é–“ã‚’è¨ˆç®—ã—ã€ãã®æ™‚é–“ã¨ record.date ã¨ã®å·®åˆ†ã§ã¯ãªã„ã€‚
                    // record.date ã‹ã‚‰ã€Œç¾åœ¨ï¼‹iæ—¥ã€ã¾ã§ã®çµŒéæ™‚é–“ã§è¨ˆç®—ã™ã¹ã
                    // ã„ã‚„ã€ã‚°ãƒ©ãƒ•ã¯ã€Œå­¦ç¿’ã—ãŸç¬é–“(record.date)ã‹ã‚‰è¦‹ã¦ã€iæ—¥å¾Œã®ä¿æŒç‡ã€ã‚’ç¤ºã™ã¹ã
                    const elapsedMinutesForPlot = i * 24 * 60;
                    const retention = calculateRetention(elapsedMinutesForPlot, record.difficulty);
                    data.push(retention);
                }

                datasets.push({
                    label: `${record.category} - ${record.topic.substring(0, 20)}${record.topic.length > 20 ? '...' : ''}`, // ãƒ©ãƒ™ãƒ«ãŒé•·ã™ããªã„ã‚ˆã†ã«èª¿æ•´
                    data: data,
                    borderColor: categoryColors[record.category] || `hsl(${index * 40 % 360}, 70%, 60%)`,
                    backgroundColor: `hsla(${index * 40 % 360}, 70%, 60%, 0.1)`,
                    tension: 0.3,
                    borderWidth: 2,
                    pointRadius: 3,
                    pointHoverRadius: 5
                });
            });

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'AI-900 å„ãƒˆãƒ”ãƒƒã‚¯ã®è¨˜æ†¶ä¿æŒç‡äºˆæ¸¬ (å­¦ç¿’æ—¥ã‹ã‚‰èµ·ç®—)',
                            font: { size: 16, weight: 'bold' },
                            padding: { top: 10, bottom: 20 }
                        },
                        legend: {
                            display: datasets.length > 0 && datasets.length < 10, // ã‚ã¾ã‚Šã«å¤šã„ã¨å‡¡ä¾‹ãŒé‚ªé­”ã«ãªã‚‹ã®ã§åˆ¶é™
                            position: 'bottom',
                            labels: {
                                font: { size: 12 },
                                boxWidth: 20,
                                padding: 20
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += Math.round(context.parsed.y * 10) / 10 + '%';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: { display: true, text: 'è¨˜æ†¶ä¿æŒç‡ (%)', font: { size: 14 } },
                            ticks: { stepSize: 10 }
                        },
                        x: {
                            title: { display: true, text: 'å­¦ç¿’æ—¥ã‹ã‚‰ã®çµŒéæ—¥æ•°', font: { size: 14 } }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }


        // è¨˜éŒ²ã®å‰Šé™¤
        function deleteRecord(index) {
            if (confirm('ã“ã®å­¦ç¿’è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                studyRecords.splice(index, 1);
                updateMemoryLevel();
                updateStudyListAndAnimateNewItem();
                drawChart();
            }
        }

        // ã‚¯ã‚¤ã‚ºç”Ÿæˆ
        function generateQuiz() {
            const category = document.getElementById('quizCategory').value;
            const quizContent = document.getElementById('quizContent');
            
            // quizPoolãŒç©ºã‹ã€ã‚­ãƒ¼ã‚’æŒãŸãªã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆã®ã‚¬ãƒ¼ãƒ‰ç¯€
            if (!quizPool || Object.keys(quizPool).length === 0) {
                quizContent.innerHTML = '<p>å•é¡Œãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã—ã°ã‚‰ãå¾…ã¤ã‹ã€ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚</p>';
                return;
            }
            
            let availableQuestions = [];
            
            if (category === 'all') {
                Object.values(quizPool).forEach(questionsInCategory => {
                    if (Array.isArray(questionsInCategory)) {
                        availableQuestions = availableQuestions.concat(questionsInCategory);
                    }
                });
            } else if (quizPool[category] && Array.isArray(quizPool[category])) {
                availableQuestions = quizPool[category];
            }
            
            if (availableQuestions.length === 0) {
                quizContent.innerHTML = '<p>é¸æŠã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªãƒ¼ã«å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä»–ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã™ã‚‹ã‹ã€å•é¡Œãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>';
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * availableQuestions.length);
            const questionData = availableQuestions[randomIndex]; // question ã ã¨å¤‰æ•°åãŒè¢«ã‚‹ã®ã§å¤‰æ›´
            
            quizContent.innerHTML = `
                <div class="quiz-question">
                    <h3>å•é¡Œ ${quizStats.today + 1}</h3>
                    <p style="font-size: 1.1em; margin-bottom: 20px;">${questionData.question}</p>
                    <div class="quiz-options">
                        ${questionData.options.map((option, index) => `
                            <div class="quiz-option" onclick="selectAnswer(${index}, ${questionData.correct}, '${String(questionData.explanation || '').replace(/'/g, "\\'")}')">
                                ${String.fromCharCode(65 + index)}. ${option}
                            </div>
                        `).join('')}
                    </div>
                    <div id="quizFeedback"></div>
                </div>
            `;
            
            quizStats.today++; // å•é¡Œã‚’ç”Ÿæˆã—ãŸã‚‰ã‚«ã‚¦ãƒ³ãƒˆ
            updateQuizStats();
        }


        // ç­”ãˆã‚’é¸æŠ
        function selectAnswer(selected, correct, explanation) {
            const options = document.querySelectorAll('.quiz-option');
            const feedback = document.getElementById('quizFeedback');
            
            // ã™ã§ã«å›ç­”æ¸ˆã¿ã®å ´åˆã¯ä½•ã‚‚ã—ãªã„ (ã‚¯ãƒ©ã‚¹ã§åˆ¤å®š)
            if (options.length > 0 && (options[0].classList.contains('correct') || options[0].classList.contains('incorrect'))) {
                // quiz-option ãŒå­˜åœ¨ã—ãªã„å ´åˆã®ã‚¨ãƒ©ãƒ¼ã‚’é¿ã‘ã‚‹
                if (Array.from(options).some(opt => opt.classList.contains('correct') || opt.classList.contains('incorrect'))) {
                   return;
                }
            }
            
            options.forEach((option, index) => {
                option.classList.remove('selected'); // ä¸€æ—¦ãƒªã‚»ãƒƒãƒˆ
                option.style.pointerEvents = 'none'; // å›ç­”å¾Œã¯é¸æŠä¸å¯ã«
                if (index === selected) {
                    option.classList.add('selected');
                }
                // æ­£è§£ã®é¸æŠè‚¢ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                if (index === correct) {
                    option.classList.add('correct');
                } 
                // é¸æŠã—ãŸã‚‚ã®ãŒä¸æ­£è§£ã®å ´åˆã€é¸æŠã—ãŸã‚‚ã®ã‚‚ä¸æ­£è§£ã¨ã—ã¦ãƒãƒ¼ã‚¯
                else if (index === selected && index !== correct) {
                    option.classList.add('incorrect');
                }
            });
            
            quizStats.total++;
            
            if (selected === correct) {
                quizStats.correct++;
                quizStats.streak++;
                feedback.innerHTML = `
                    <div class="quiz-feedback correct">
                        <strong>æ­£è§£ã§ã™ï¼</strong><br>${explanation}
                    </div>
                    <button class="btn btn-success" onclick="generateQuiz()" style="margin-top: 20px;">æ¬¡ã®å•é¡Œã¸</button>
                `;
            } else {
                quizStats.streak = 0;
                feedback.innerHTML = `
                    <div class="quiz-feedback incorrect">
                        <strong>ä¸æ­£è§£ã§ã™ã€‚</strong>æ­£è§£ã¯ ${String.fromCharCode(65 + correct)} ã§ã™ã€‚<br><br>
                        ${explanation}
                    </div>
                    <button class="btn btn-danger" onclick="generateQuiz()" style="margin-top: 20px;">æ¬¡ã®å•é¡Œã¸</button>
                `;
            }
            
            updateQuizStats();
        }

        // ã‚¯ã‚¤ã‚ºçµ±è¨ˆã‚’æ›´æ–°
        function updateQuizStats() {
            document.getElementById('todayQuestions').textContent = quizStats.today;
            document.getElementById('correctRate').textContent = quizStats.total > 0 
                ? Math.round((quizStats.correct / quizStats.total) * 100) + '%' 
                : '0%';
            document.getElementById('streak').textContent = quizStats.streak;
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ ã®å‡¦ç†
        document.getElementById('studyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            console.log('å­¦ç¿’å†…å®¹ã‚’è¨˜éŒ²ä¸­...');
            
            const newRecord = {
                category: document.getElementById('category').value,
                topic: document.getElementById('topic').value,
                details: document.getElementById('details').value,
                question: document.getElementById('question').value,
                answer: document.getElementById('answer').value,
                difficulty: parseFloat(document.getElementById('difficulty').value),
                date: new Date().toISOString(),
                isNew: true 
            };

            console.log('è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿:', newRecord);

            const existingIndex = studyRecords.findIndex(r => 
                r.category === newRecord.category && r.topic === newRecord.topic
            );

            if (existingIndex !== -1) {
                studyRecords[existingIndex] = newRecord;
                console.log('æ—¢å­˜ã®è¨˜éŒ²ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
            } else {
                studyRecords.push(newRecord);
                console.log('æ–°è¦è¨˜éŒ²ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
            }

            updateMemoryLevel();
            updateStudyListAndAnimateNewItem(); 
            drawChart();

            this.reset();
            
            const btn = this.querySelector('.btn');
            const originalText = btn.textContent;
            btn.textContent = 'âœ“ è¨˜éŒ²ã—ã¾ã—ãŸï¼';
            btn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = 'linear-gradient(135deg, #0078d4 0%, #005a9e 100%)';
            }, 2000);
        });

        // æ–°ã—ã„é–¢æ•°: ãƒªã‚¹ãƒˆã‚’æ›´æ–°ã—ã€æ–°ã—ã„ã‚¢ã‚¤ãƒ†ãƒ ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨
        function updateStudyListAndAnimateNewItem() {
            const studyList = document.getElementById('studyList');
            
            if (studyRecords.length === 0) {
                studyList.innerHTML = `
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 11H6a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2h-3"></path>
                            <rect x="8" y="2" width="8" height="11" rx="1"></rect>
                        </svg>
                        <p>ã¾ã å­¦ç¿’è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>
                    </div>
                `;
                return;
            }

            studyList.innerHTML = ''; 
            const now = new Date();
            let newElement = null; 

            studyRecords.sort((a, b) => new Date(b.date) - new Date(a.date)); // æ—¥ä»˜ã®æ–°ã—ã„é †ã«ã‚½ãƒ¼ãƒˆ

            studyRecords.forEach((record, index) => {
                // index ã¯ã‚½ãƒ¼ãƒˆå¾Œã®ã‚‚ã®ãªã®ã§ã€å…ƒã® studyRecords ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã¯ç•°ãªã‚‹ç‚¹ã«æ³¨æ„
                // deleteRecord ã§ä½¿ã†ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯å…ƒã® studyRecords ã®ã‚‚ã®ã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€
                // record ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè‡ªä½“ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯IDã‚’æŒãŸã›ã‚‹ã‹ã€
                // deleteRecord ã«æ¸¡ã™è­˜åˆ¥å­ã‚’å·¥å¤«ã™ã‚‹å¿…è¦ãŒå‡ºã¦ãã‚‹
                // ä»Šå›ã¯ã‚·ãƒ³ãƒ—ãƒ«ã« index ã‚’ãã®ã¾ã¾ä½¿ã†ãŒã€å‰Šé™¤æ™‚ã®æŒ™å‹•ã«æ³¨æ„
                const originalIndex = studyRecords.indexOf(record); // ã‚½ãƒ¼ãƒˆå‰ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä¿æŒ (ã‚ã¾ã‚ŠåŠ¹ç‡çš„ã§ã¯ãªã„)
                                                                  // ã‚ˆã‚Šè‰¯ã„ã®ã¯IDã‚’å„ãƒ¬ã‚³ãƒ¼ãƒ‰ã«æŒ¯ã‚‹ã“ã¨

                const elapsedMinutes = (now - new Date(record.date)) / (1000 * 60);
                const retention = calculateRetention(elapsedMinutes, record.difficulty);
                
                const studyItem = document.createElement('div');
                studyItem.className = 'study-item';

                studyItem.innerHTML = `
                    <div class="study-item-header">
                        <div>
                            <span class="category-tag">${record.category}</span>
                            <div class="study-item-title">${record.topic}</div>
                            <div class="study-item-date">${new Date(record.date).toLocaleString('ja-JP', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</div>
                        </div>
                        <button class="delete-btn" onclick="deleteRecord(${originalIndex})">å‰Šé™¤</button> 
                    </div>
                    <div class="study-item-retention">ç¾åœ¨ã®è¨˜æ†¶ä¿æŒç‡: <strong>${Math.round(retention)}%</strong> (ç†è§£åº¦: ${record.difficulty * 100}%)</div>
                    <div style="font-size: 0.85em; color: #555; margin-top: 10px; white-space: pre-wrap; word-wrap: break-word;">${record.details}</div>
                    ${record.question ? `
                        <div style="margin-top: 15px; padding: 15px; background: #f0f4ff; border-radius: 8px;">
                            <details>
                                <summary style="font-weight: 600; color: #0078d4; cursor: pointer;">å•é¡Œã‚’è¦‹ã‚‹</summary>
                                <div style="color: #555; margin-top: 8px; white-space: pre-wrap; word-wrap: break-word;"><strong>å•é¡Œ:</strong><br>${record.question}</div>
                                <div style="color: #555; margin-top: 10px; white-space: pre-wrap; word-wrap: break-word;"><strong>ç­”ãˆ:</strong><br>${record.answer}</div>
                            </details>
                        </div>
                    ` : ''}
                `;
                
                studyList.appendChild(studyItem);

                if (record.isNew) {
                    newElement = studyItem;
                    delete record.isNew; 
                }
            });

            if (newElement) {
                newElement.classList.add('study-item-appear');
            }
        }


        // å®šæœŸçš„ã«è¨˜æ†¶ãƒ¬ãƒ™ãƒ«ã‚’æ›´æ–°ï¼ˆ1åˆ†ã”ã¨ï¼‰
        setInterval(() => {
            if (studyRecords.length > 0) {
                updateMemoryLevel();
                updateStudyListAndAnimateNewItem(); 
            }
        }, 60000); // 1åˆ† = 60000ãƒŸãƒªç§’
    </script>
</body>
</html>